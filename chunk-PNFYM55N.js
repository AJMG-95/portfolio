import{B as X,Ba as C,G as ee,I as te,Ja as se,K as w,L as ne,Lb as E,M as ie,N as F,P as y,R as h,Rb as $,S as g,T as S,U as v,a as d,b as m,c as z,ca as T,f as U,ga as x,i as J,j as W,k as Y,l as I,m as D,q as b,r as Z,w as N,y as Q}from"./chunk-MI6WIFQ5.js";function re(t){t||(t=S(T));let r=new U(e=>{if(t.destroyed){e.next();return}return t.onDestroy(e.next.bind(e))});return e=>e.pipe(ne(r))}function ye(t,r){let n=!r?.manualCleanup?r?.injector?.get(T)??S(T):null,i=Se(r?.equal),s;r?.requireSync?s=x({kind:0},{equal:i}):s=x({kind:1,value:r?.initialValue},{equal:i});let a,o=t.subscribe({next:c=>s.set({kind:1,value:c}),error:c=>{s.set({kind:2,error:c}),a?.()},complete:()=>{a?.()}});if(r?.requireSync&&s().kind===0)throw new F(601,!1);return a=n?.onDestroy(o.unsubscribe.bind(o)),E(()=>{let c=s();switch(c.kind){case 1:return c.value;case 2:throw c.error;case 0:throw new F(601,!1)}},{equal:r?.equal})}function Se(t=Object.is){return(r,e)=>r.kind===1&&e.kind===1&&t(r.value,e.value)}function ae(t){return typeof t=="function"}function L(t){return typeof t=="string"}function M(t){return!!t&&typeof t=="object"&&!Array.isArray(t)}function j(t){return t==null}function k(t){return!j(t)}function P(t){return t?Array.isArray(t)||L(t)?t.length:M(t)?Object.keys(t).length:0:0}function oe(t){return P(t)===0}function _(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,(r,e)=>e==0?r.toLowerCase():r.toUpperCase()).replace(/\s+|_|-|\//g,"")}var K=class{translations;constructor(r){this.translations=r}getTranslation(r){return D(this.translations.get(r)||{})}},le=new h(""),O=new h("",{providedIn:"root",factory:()=>A}),A={defaultLang:"en",reRenderOnLangChange:!1,prodMode:!1,failedRetries:2,fallbackLang:[],availableLangs:[],missingHandler:{logMissingKey:!0,useFallbackTranslation:!1,allowEmpty:!1},flatten:{aot:!1},interpolation:["{{","}}"],scopes:{keepCasing:!1}};function Te(t={}){return m(d(d({},A),t),{missingHandler:d(d({},A.missingHandler),t.missingHandler),flatten:d(d({},A.flatten),t.flatten),scopes:d(d({},A.scopes),t.scopes)})}function V(t,r){return t&&(Object.prototype.hasOwnProperty.call(t,r)?t[r]:r.split(".").reduce((e,n)=>e?.[n],t))}function Ae(t,r,e){t=d({},t);let n=r.split("."),i=n.length-1;return n.reduce((s,a,o)=>(o===i?s[a]=e:s[a]=Array.isArray(s[a])?s[a].slice():d({},s[a]),s&&s[a]),t),t}var ue=new h(""),Oe=(()=>{class t{config=S(O,{optional:!0})??A;get interpolationMatcher(){return we(this.config)}transpile({value:e,params:n={},translation:i,key:s}){if(L(e)){let a,o=e;for(;(a=this.interpolationMatcher.exec(o))!==null;){let[c,l]=a;o=o.replace(c,()=>{let u=l.trim(),f=V(n,u);return k(f)?f:k(i[u])?this.transpile({params:n,translation:i,key:s,value:i[u]}):""})}return o}else n&&(M(e)?e=this.handleObject({value:e,params:n,translation:i,key:s}):Array.isArray(e)&&(e=this.handleArray({value:e,params:n,translation:i,key:s})));return e}handleObject({value:e,params:n={},translation:i,key:s}){let a=e;return Object.keys(n).forEach(o=>{let c=this.transpile({value:V(a,o),params:V(n,o),translation:i,key:s});a=Ae(a,o,c)}),a}handleArray(i){var s=i,{value:e}=s,n=z(s,["value"]);return e.map(a=>this.transpile(d({value:a},n)))}static \u0275fac=function(n){return new(n||t)};static \u0275prov=y({token:t,factory:t.\u0275fac})}return t})();function we(t){let[r,e]=t.interpolation;return new RegExp(`${r}([^${r}${e}]*?)${e}`,"g")}var de=new h(""),Ce=(()=>{class t{handle(e,n){if(n.missingHandler.logMissingKey&&!n.prodMode){let i=`Missing translation for '${e}'`;console.warn(`%c ${i}`,"font-size: 12px; color: red")}return e}static \u0275fac=function(n){return new(n||t)};static \u0275prov=y({token:t,factory:t.\u0275fac})}return t})(),fe=new h(""),Me=(()=>{class t{preSaveTranslation(e){return e}preSaveTranslationKey(e,n){return n}static \u0275fac=function(n){return new(n||t)};static \u0275prov=y({token:t,factory:t.\u0275fac})}return t})(),he=new h(""),Re=(()=>{class t{userConfig;constructor(e){this.userConfig=e}getNextLangs(){let e=this.userConfig.fallbackLang;if(!e)throw new Error("When using the default fallback, a fallback language must be provided in the config!");return Array.isArray(e)?e:[e]}static \u0275fac=function(n){return new(n||t)(g(O))};static \u0275prov=y({token:t,factory:t.\u0275fac})}return t})();function ge(t){let{path:r,inlineLoader:e,mainLoader:n,data:i}=t;if(e){let s=e[r];if(ae(s)===!1)throw`You're using an inline loader but didn't provide a loader for ${r}`;return e[r]().then(a=>a.default?a.default:a)}return n.getTranslation(r,i)}function De({mainLoader:t,path:r,data:e,fallbackPath:n,inlineLoader:i}){return(n?[r,n]:[r]).map(a=>{let o=ge({path:a,mainLoader:t,inlineLoader:i,data:e});return I(o).pipe(b(c=>({translation:c,lang:a})))})}function ce(t){let r={};function e(n,i){if(n===null)r[i]=null;else if(M(n))for(let[s,a]of Object.entries(n))e(a,i?`${i}.${s}`:s);else r[i]=n}return e(t,""),r}function je(t){let r={};for(let[e,n]of Object.entries(t)){let i=e.split("."),s=r;i.forEach((a,o)=>{o===i.length-1?s[a]=n:(s[a]??={},s=s[a])})}return r}function R(t){if(!t)return"";let r=t.split("/");return r.pop(),r.join("/")}function p(t){return t?t.split("/").pop():""}function Ie(t,r){return Object.keys(t).reduce((e,n)=>(e[`${r}/${n}`]=t[n],e),{})}function pe(t){return typeof t?.scope=="string"}function Ne(t){return t?.loader&&M(t.loader)}function ve(t,r){return Ne(t)?Ie(t.loader,r):void 0}function H(t){return{scope:R(t)||null,langName:p(t)}}var Fe;var xe=(()=>{class t{loader;parser;missingHandler;interceptor;fallbackStrategy;langChanges$;translations=new Map;cache=new Map;firstFallbackLang;defaultLang="";availableLangs=[];isResolvedMissingOnce=!1;lang;failedLangs=new Set;events=new J;events$=this.events.asObservable();config;destroyRef=S(T);constructor(e,n,i,s,a,o){this.loader=e,this.parser=n,this.missingHandler=i,this.interceptor=s,this.fallbackStrategy=o,this.loader||(this.loader=new K(this.translations)),Fe=this,this.config=JSON.parse(JSON.stringify(a)),this.setAvailableLangs(this.config.availableLangs||[]),this.setFallbackLangForMissingTranslation(this.config),this.setDefaultLang(this.config.defaultLang),this.lang=new W(this.getDefaultLang()),this.langChanges$=this.lang.asObservable(),this.events$.subscribe(c=>{c.type==="translationLoadSuccess"&&c.wasFailure&&this.setActiveLang(c.payload.langName)}),this.destroyRef.onDestroy(()=>{this.lang.complete(),this.events.complete(),this.cache.clear()})}getDefaultLang(){return this.defaultLang}setDefaultLang(e){this.defaultLang=e}getActiveLang(){return this.lang.getValue()}setActiveLang(e){return this.parser.onLangChanged?.(e),this.lang.next(e),this.events.next({type:"langChanged",payload:H(e)}),this}setAvailableLangs(e){this.availableLangs=e}getAvailableLangs(){return this.availableLangs}load(e,n={}){let i=this.cache.get(e);if(i)return i;let s,a=this._isLangScoped(e),o;a&&(o=R(e));let c={path:e,mainLoader:this.loader,inlineLoader:n.inlineLoader,data:a?{scope:o}:void 0};if(this.useFallbackTranslation(e)){let u=a?`${o}/${this.firstFallbackLang}`:this.firstFallbackLang,f=De(m(d({},c),{fallbackPath:u}));s=N(f)}else{let u=ge(c);s=I(u)}let l=s.pipe(ee(this.config.failedRetries),ie(u=>{if(Array.isArray(u)){u.forEach(f=>{this.handleSuccess(f.lang,f.translation),f.lang!==e&&this.cache.set(f.lang,D({}))});return}this.handleSuccess(e,u)}),Q(u=>(this.config.prodMode||console.error(`Error while trying to load "${e}"`,u),this.handleFailure(e,n))),te(1),re(this.destroyRef));return this.cache.set(e,l),l}translate(e,n={},i=this.getActiveLang()){if(!e)return e;let{scope:s,resolveLang:a}=this.resolveLangAndScope(i);if(Array.isArray(e))return e.map(l=>this.translate(s?`${s}.${l}`:l,n,a));e=s?`${s}.${e}`:e;let o=this.getTranslation(a),c=o[e];return c?this.parser.transpile({value:c,params:n,translation:o,key:e}):this._handleMissingKey(e,c,n)}selectTranslate(e,n,i,s=!1){let a,o=(l,u)=>this.load(l,u).pipe(b(()=>s?this.translateObject(e,n,l):this.translate(e,n,l)));if(j(i))return this.langChanges$.pipe(w(l=>o(l)));if(i=Array.isArray(i)?i[0]:i,pe(i)){let l=i;i=l.scope,a=ve(l,l.scope)}if(i=i,this.isLang(i)||this.isScopeWithLang(i))return o(i);let c=i;return this.langChanges$.pipe(w(l=>o(`${c}/${l}`,{inlineLoader:a})))}isScopeWithLang(e){return this.isLang(p(e))}translateObject(e,n={},i=this.getActiveLang()){if(L(e)||Array.isArray(e)){let{resolveLang:a,scope:o}=this.resolveLangAndScope(i);if(Array.isArray(e))return e.map(u=>this.translateObject(o?`${o}.${u}`:u,n,a));let c=this.getTranslation(a);e=o?`${o}.${e}`:e;let l=je(this.getObjectByKey(c,e));return oe(l)?this.translate(e,n,i):this.parser.transpile({value:l,params:n,translation:c,key:e})}let s=[];for(let[a,o]of this.getEntries(e))s.push(this.translateObject(a,o,i));return s}selectTranslateObject(e,n,i){if(L(e)||Array.isArray(e))return this.selectTranslate(e,n,i,!0);let[[s,a],...o]=this.getEntries(e);return this.selectTranslateObject(s,a,i).pipe(b(c=>{let l=[c];for(let[u,f]of o)l.push(this.translateObject(u,f,i));return l}))}getTranslation(e){if(e){if(this.isLang(e))return this.translations.get(e)||{};{let{scope:n,resolveLang:i}=this.resolveLangAndScope(e),s=this.translations.get(i)||{};return this.getObjectByKey(s,n)}}return this.translations}selectTranslation(e){let n=this.langChanges$;if(e){let i=p(e)!==e;this.isLang(e)||i?n=D(e):n=this.langChanges$.pipe(b(s=>`${e}/${s}`))}return n.pipe(w(i=>this.load(i).pipe(b(()=>this.getTranslation(i)))))}setTranslation(e,n=this.getActiveLang(),i={}){let a=d(d({},{merge:!0,emitChange:!0}),i),o=R(n),c=e;if(o){let me=this.getMappedScope(o);c=ce({[me]:e})}let l=o?p(n):n,u=d(d({},a.merge&&this.getTranslation(l)),c),f=this.config.flatten.aot?u:ce(u),Le=this.interceptor.preSaveTranslation(f,l);this.translations.set(l,Le),a.emitChange&&this.setActiveLang(this.getActiveLang())}setTranslationKey(e,n,i={}){let s=i.lang||this.getActiveLang(),a=this.interceptor.preSaveTranslationKey(e,n,s),o={[e]:a};this.setTranslation(o,s,m(d({},i),{merge:!0}))}setFallbackLangForMissingTranslation({fallbackLang:e}){let n=Array.isArray(e)?e[0]:e;e&&this.useFallbackTranslation(n)&&(this.firstFallbackLang=n)}_handleMissingKey(e,n,i){if(this.config.missingHandler.allowEmpty&&n==="")return"";if(!this.isResolvedMissingOnce&&this.useFallbackTranslation()){this.isResolvedMissingOnce=!0;let s=this.translate(e,i,this.firstFallbackLang);return this.isResolvedMissingOnce=!1,s}return this.missingHandler.handle(e,this.getMissingHandlerData(),i)}_isLangScoped(e){return this.getAvailableLangsIds().indexOf(e)===-1}isLang(e){return this.getAvailableLangsIds().indexOf(e)!==-1}_loadDependencies(e,n){let i=p(e);return this._isLangScoped(e)&&!this.isLoadedTranslation(i)?Z([this.load(i),this.load(e,{inlineLoader:n})]):this.load(e,{inlineLoader:n})}_completeScopeWithLang(e){return this._isLangScoped(e)&&!this.isLang(p(e))?`${e}/${this.getActiveLang()}`:e}_setScopeAlias(e,n){this.config.scopeMapping||(this.config.scopeMapping={}),this.config.scopeMapping[e]=n}isLoadedTranslation(e){return P(this.getTranslation(e))}getAvailableLangsIds(){let e=this.getAvailableLangs()[0];return L(e)?this.getAvailableLangs():this.getAvailableLangs().map(n=>n.id)}getMissingHandlerData(){return m(d({},this.config),{activeLang:this.getActiveLang(),availableLangs:this.availableLangs,defaultLang:this.defaultLang})}useFallbackTranslation(e){return this.config.missingHandler.useFallbackTranslation&&e!==this.firstFallbackLang}handleSuccess(e,n){this.setTranslation(n,e,{emitChange:!1}),this.events.next({wasFailure:!!this.failedLangs.size,type:"translationLoadSuccess",payload:H(e)}),this.failedLangs.forEach(i=>this.cache.delete(i)),this.failedLangs.clear()}handleFailure(e,n){j(n.failedCounter)&&(n.failedCounter=0,n.fallbackLangs||(n.fallbackLangs=this.fallbackStrategy.getNextLangs(e)));let i=e.split("/"),a=n.fallbackLangs[n.failedCounter];if(this.failedLangs.add(e),this.cache.has(a))return this.handleSuccess(a,this.getTranslation(a)),Y;let o=a===i[i.length-1];if(!a||o){let l="Unable to load translation and all the fallback languages";throw i.length>1&&(l+=", did you misspelled the scope name?"),new Error(l)}let c=a;return i.length>1&&(i[i.length-1]=a,c=i.join("/")),n.failedCounter++,this.events.next({type:"translationLoadFailure",payload:H(e)}),this.load(c,n)}getMappedScope(e){let{scopeMapping:n={},scopes:i={keepCasing:!1}}=this.config;return n[e]||(i.keepCasing?e:_(e))}resolveLangAndScope(e){let n=e,i;if(this._isLangScoped(e)){let s=p(e),a=this.isLang(s);n=a?s:this.getActiveLang(),i=this.getMappedScope(a?R(e):e)}return{scope:i,resolveLang:n}}getObjectByKey(e,n){let i={},s=`${n}.`;for(let a in e)a.startsWith(s)&&(i[a.replace(s,"")]=e[a]);return i}getEntries(e){return e instanceof Map?e.entries():Object.entries(e)}static \u0275fac=function(n){return new(n||t)(g(le,8),g(ue),g(de),g(fe),g(O),g(he))};static \u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ee=new h(""),Pt=new h(""),$e=new h("");function B(t,r,e="|"){if(L(t)){let n=t.split(e),i=n.pop();return i===r?[!0,n.toString()]:[!1,i]}return[!1,""]}function ke(t,r){let[e]=B(r,"static");return e?!1:!!t.config.reRenderOnLangChange}function Pe(t){return t?r=>r:X(1)}var G=class{initialized=!1;resolve({inline:r,provider:e,active:n}){let i=n;if(this.initialized)return i=n,i;if(e){let[,s]=B(e,"static");i=s}if(r){let[,s]=B(r,"static");i=s}return this.initialized=!0,i}resolveLangBasedOnScope(r){return R(r)?p(r):r}resolveLangPath(r,e){return e?`${e}/${r}`:r}},q=class{service;constructor(r){this.service=r}resolve(r){let{inline:e,provider:n}=r;if(e)return e;if(n){if(pe(n)){let{scope:i,alias:s=this.service.config.scopes.keepCasing?i:_(i)}=n;return this.service._setScopeAlias(i,s),i}return n}}};var _t=(()=>{class t{service;providerScope;providerLang;cdr;subscription=null;lastValue="";lastKey;path;langResolver=new G;scopeResolver;constructor(e,n,i,s){this.service=e,this.providerScope=n,this.providerLang=i,this.cdr=s,this.scopeResolver=new q(this.service)}transform(e,n,i){if(!e)return e;let s=n?`${e}${JSON.stringify(n)}`:e;if(s===this.lastKey)return this.lastValue;this.lastKey=s,this.subscription?.unsubscribe();let a=ke(this.service,this.providerLang||i);return this.subscription=this.service.langChanges$.pipe(w(o=>{let c=this.langResolver.resolve({inline:i,provider:this.providerLang,active:o});return Array.isArray(this.providerScope)?N(this.providerScope.map(l=>this.resolveScope(c,l))):this.resolveScope(c,this.providerScope)}),Pe(a)).subscribe(()=>this.updateValue(e,n)),this.lastValue}ngOnDestroy(){this.subscription?.unsubscribe(),this.subscription=null}updateValue(e,n){let i=this.langResolver.resolveLangBasedOnScope(this.path);this.lastValue=this.service.translate(e,n,i),this.cdr.markForCheck()}resolveScope(e,n){let i=this.scopeResolver.resolve({inline:void 0,provider:n});this.path=this.langResolver.resolveLangPath(e,i);let s=ve(n,i);return this.service._loadDependencies(this.path,s)}static \u0275fac=function(n){return new(n||t)(C(xe,16),C($e,24),C(Ee,24),C($,16))};static \u0275pipe=se({name:"transloco",type:t,pure:!1})}return t})();function Vt(t){let r=[He(Oe),Be(Ce),Ge(Me),Ke(Re)];return t.config&&r.push(_e(t.config)),t.loader&&r.push(Ve(t.loader)),r}function _e(t){return v([{provide:O,useValue:Te(t)}])}function Ve(t){return v([{provide:le,useClass:t}])}function He(t){return v([{provide:ue,useClass:t,deps:[O]}])}function Ke(t){return v([{provide:he,useClass:t,deps:[O]}])}function Be(t){return v([{provide:de,useClass:t}])}function Ge(t){return v([{provide:fe,useClass:t}])}var Ht=new h("TRANSLOCO_TEST_LANGS - Available testing languages"),Kt=new h("TRANSLOCO_TEST_OPTIONS - Testing options");export{ye as a,xe as b,_t as c,Vt as d};
