<!-- project-card.component.html -->
<article
  class="card overflow-hidden w-[20rem] sm:w-[22rem] shadow-sm shadow-neutral/50 dark:shadow-white/50 border-0 rounded-2xl bg-white dark:bg-white/5"
>
  @if (project().images?.headerImageUrl) {
  <figure class="h-40 overflow-hidden bg-primary/10">
    <img
      [src]="project().images!.headerImageUrl!"
      [alt]="project().nameKey | transloco"
      class="h-full w-full object-cover"
      loading="lazy"
    />
  </figure>
  } @else {
  <div class="h-40 overflow-hidden bg-primary/10 text-center content-center">
    <p>{{ 'messages.no_pictures' | transloco }}</p>
  </div>
  }
  <div class="card-body p-4">
    <div class="flex items-start gap-3">
      @if (project().images?.cornerImageUrl) {
      <img
        [src]="project().images!.cornerImageUrl!"
        [alt]="project().nameKey | transloco"
        class="h-11 w-11 rounded-md object-contain border p-1"
        loading="lazy"
      />
      }
      <div class="min-w-0">
        <h3 class="text-base font-semibold leading-tight truncate mb-1">
          {{ project().nameKey | transloco }}
        </h3>
        <p class="text-xs opacity-70">
          <span class="badge badge-sm" [class]="statusBadge(project().status)">
            {{ 'status.' + project().status | transloco : { defaultValue: project().status } }}
          </span>
          <span class="ms-2 align-middle opacity-60">
            {{ 'filters.' + project().category | transloco }} · {{ project().size }}
          </span>
        </p>
      </div>
    </div>

    @if (project().shortDescriptionKey) {
    <div class="h-15 overflow-y-auto bg-scroll">
      <p class="text-sm mt-2 line-clamp-3">
        {{ project().shortDescriptionKey! | transloco }}
      </p>
    </div>
    } @else {
    <div class="h-15 overflow-y-auto bg-scroll">
      <p class="text-sm mt-2 line-clamp-3">
        {{ 'projects.default_intro' | transloco : { name: (project().nameKey | transloco) } }}
      </p>
    </div>
    }

    <div class="card-actions mt-3 justify-between">
      <div class="flex flex-wrap gap-1 my-2">
        @if (project().techRefs.frontFrameworkIds?.length) {
        <span class="badge badge-outline badge-sm">Frontend</span>
        } @if (project().techRefs.backFrameworkIds?.length) {
        <span class="badge badge-outline badge-sm">Backend</span>
        } @if (project().techRefs.uiLibraryIds?.length) {
        <span class="badge badge-outline badge-sm">UI</span>
        } @if (project().techRefs.clientStorageIds?.length) {
        <span class="badge badge-outline badge-sm">Storage</span>
        }
      </div>

      <div class="w-full flex flex-row justify-between">
        <div class="flex gap-2">
          @if (project().links?.liveUrl) {
          <a
            class="btn btn-sm btn-primary"
            [href]="project().links!.liveUrl!"
            target="_blank"
            rel="noopener"
          >
            {{ 'buttons.view_project' | transloco }}
          </a>
          } @if (project().links?.githubUrl) {
          <a
            class="btn btn-sm btn-outline"
            [href]="project().links!.githubUrl!"
            target="_blank"
            rel="noopener"
          >
            GitHub
          </a>
          }
        </div>

        <button type="button" class="btn btn-sm btn-outline btn-info" (click)="openModal()">
          {{ 'buttons.see_more' | transloco : { defaultValue: 'Ver más' } }}
        </button>
      </div>
    </div>
  </div>
</article>

<!-- MODAL con galería + chips + descripción larga -->
<dialog #dlg class="modal modal-middle" (click)="onBackdropClick($event)" (close)="onNativeClose()">
  <div
    class="modal-box w-full max-w-[92vw] sm:max-w-2xl lg:max-w-3xl xl:max-w-4xl max-h-[85vh] overflow-y-auto rounded-2xl border bg-base-100 animate-fade-in space-y-4"
  >
    <!-- Header -->
    <header class="flex items-start gap-3">
      @if (project().images?.cornerImageUrl) {
      <img
        [src]="project().images!.cornerImageUrl!"
        [alt]="project().nameKey | transloco"
        class="h-12 w-12 rounded-md object-contain border p-1"
        loading="lazy"
      />
      }
      <div class="min-w-0">
        <h3 class="text-lg font-bold leading-tight">
          {{ project().nameKey | transloco }}
        </h3>
        <p class="text-xs opacity-70">
          <span class="badge badge-xs" [class]="statusBadge(project().status)">
            {{ 'status.' + project().status | transloco : { defaultValue: project().status } }}
          </span>
          <span class="ms-2"
            >{{ 'filters.' + project().category | transloco }} · {{ project().size }}</span
          >
        </p>
      </div>
    </header>

    <!-- Galería -->
    @if (project().images?.galleryImages?.length) {
    <photo-gallery
      [images]="project().images!.galleryImages!"
      [title]="'gallery.title' | transloco : { name: (project().nameKey | transloco) }"
    />
    }

    <!-- Descripción larga -->
    @if (project().longDescriptionKey) {
    <p class="text-sm leading-relaxed mt-2">
      {{ project().longDescriptionKey! | transloco }}
    </p>
    }

    <!-- Chips de tecnologías / metodologías -->
    @let t = techs(); @if (t) {
<section class="grid gap-6
         grid-cols-[repeat(auto-fit,minmax(18rem,1fr))]
         items-start content-start">
  <!-- Frontend -->
  @if (t.frontLanguages.length>0) {
  <tech-chips [titleKey]="'labels.languages'" [items]="t.frontLanguages" />
  }
  @if (t.frontFrameworks.length>0) {
  <tech-chips [titleKey]="'Frameworks'" [items]="t.frontFrameworks" />
  }

  <!-- Backend -->
  @if (t.backFrameworks.length>0) {
  <tech-chips [titleKey]="'filters.backend'" [items]="t.backFrameworks.concat(t.backLanguages)" />
  }

  <!-- UI -->
  @if (t.uiLibraries.length>0) {
  <tech-chips [titleKey]="'UI'" [items]="t.uiLibraries" />
  }

  <!-- Client storage -->
  @if (t.clientStorage.length>0) {
  <tech-chips [titleKey]="'about.client_storage'" [items]="t.clientStorage" />
  }

  <!-- Databases -->
  @if (t.databases.length>0) {
  <tech-chips [titleKey]="'labels.databases'" [items]="t.databases" />
  }

  <!-- Version control -->
  @if (t.versionControl.length>0) {
  <tech-chips [titleKey]="'about.version_control'" [items]="t.versionControl" />
  }

  <!-- BaaS -->
  @if (t.baasPlatforms.length>0) {
  <tech-chips [titleKey]="'labels.baas_platforms'" [items]="t.baasPlatforms" />
  }

  <!-- Cloud -->
  @if (t.cloudPlatforms.length>0) {
  <tech-chips [titleKey]="'labels.cloud_platforms'" [items]="t.cloudPlatforms" />
  }
</section>

    }

    <div class="modal-action">
      @if (project().links?.liveUrl) {
      <a class="btn btn-primary" [href]="project().links!.liveUrl!" target="_blank" rel="noopener">
        {{ 'buttons.view_project' | transloco }}
      </a>
      } @if (project().links?.githubUrl) {
      <a
        class="btn btn-outline"
        [href]="project().links!.githubUrl!"
        target="_blank"
        rel="noopener"
      >
        GitHub
      </a>
      }
      <button class="btn" (click)="closeModal()">{{ 'buttons.close' | transloco }}</button>
    </div>
  </div>

  <form method="dialog" class="modal-backdrop">
    <button aria-label="Close modal">close</button>
  </form>
</dialog>
